        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>Utf8Decoder class / utf Library / Hop Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="utf" data-type="Utf8Decoder">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Hop Documentation</a>
         &rsaquo; <a href="../utf.html">utf</a> &rsaquo; <a href="../utf/Utf8Decoder.html">Utf8Decoder</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>Utf8Decoder</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<p>Provides an iterator of Unicode codepoints from UTF-8 encoded bytes. The
parameters can set an offset into a list of bytes (as int), limit the length
of the values to be decoded, and override the default Unicode replacement
character. Set the replacementCharacter to null to throw an
ArgumentError rather than replace the bad value. The return value
from this method can be used as an Iterable (e.g. in a for-loop).</p>
<pre class="source">
class Utf8Decoder implements Iterator&lt;int&gt; {
 final _ListRangeIterator utf8EncodedBytesIterator;
 final int replacementCodepoint;
 int _current = null;

 Utf8Decoder(List&lt;int&gt; utf8EncodedBytes, [int offset = 0, int length,
     this.replacementCodepoint =
     UNICODE_REPLACEMENT_CHARACTER_CODEPOINT]) :
     utf8EncodedBytesIterator =
         (new _ListRange(utf8EncodedBytes, offset, length)).iterator;


 Utf8Decoder._fromListRangeIterator(_ListRange source, [
     this.replacementCodepoint =
     UNICODE_REPLACEMENT_CHARACTER_CODEPOINT]) :
     utf8EncodedBytesIterator = source.iterator;

 /** Decode the remaininder of the characters in this decoder
   * into a [List&lt;int&gt;].
   */
 List&lt;int&gt; decodeRest() {
   List&lt;int&gt; codepoints = new List&lt;int&gt;(utf8EncodedBytesIterator.remaining);
   int i = 0;
   while (moveNext()) {
     codepoints[i++] = current;
   }
   if (i == codepoints.length) {
     return codepoints;
   } else {
     List&lt;int&gt; truncCodepoints = new List&lt;int&gt;(i);
     truncCodepoints.setRange(0, i, codepoints);
     return truncCodepoints;
   }
 }

 int get current =&gt; _current;

 bool moveNext() {
   _current = null;

   if (!utf8EncodedBytesIterator.moveNext()) return false;

   int value = utf8EncodedBytesIterator.current;
   int additionalBytes = 0;

   if (value &lt; 0) {
     if (replacementCodepoint != null) {
       _current = replacementCodepoint;
       return true;
     } else {
       throw new ArgumentError(
           "Invalid UTF8 at ${utf8EncodedBytesIterator.position}");
     }
   } else if (value &lt;= _UTF8_ONE_BYTE_MAX) {
     _current = value;
     return true;
   } else if (value &lt; _UTF8_FIRST_BYTE_OF_TWO_BASE) {
     if (replacementCodepoint != null) {
       _current = replacementCodepoint;
       return true;
     } else {
       throw new ArgumentError(
           "Invalid UTF8 at ${utf8EncodedBytesIterator.position}");
     }
   } else if (value &lt; _UTF8_FIRST_BYTE_OF_THREE_BASE) {
     value -= _UTF8_FIRST_BYTE_OF_TWO_BASE;
     additionalBytes = 1;
   } else if (value &lt; _UTF8_FIRST_BYTE_OF_FOUR_BASE) {
     value -= _UTF8_FIRST_BYTE_OF_THREE_BASE;
     additionalBytes = 2;
   } else if (value &lt; _UTF8_FIRST_BYTE_OF_FIVE_BASE) {
     value -= _UTF8_FIRST_BYTE_OF_FOUR_BASE;
     additionalBytes = 3;
   } else if (value &lt; _UTF8_FIRST_BYTE_OF_SIX_BASE) {
     value -= _UTF8_FIRST_BYTE_OF_FIVE_BASE;
     additionalBytes = 4;
   } else if (value &lt; _UTF8_FIRST_BYTE_BOUND_EXCL) {
     value -= _UTF8_FIRST_BYTE_OF_SIX_BASE;
     additionalBytes = 5;
   } else if (replacementCodepoint != null) {
     _current = replacementCodepoint;
     return true;
   } else {
     throw new ArgumentError(
         "Invalid UTF8 at ${utf8EncodedBytesIterator.position}");
   }
   int j = 0;
   while (j &lt; additionalBytes &amp;&amp; utf8EncodedBytesIterator.moveNext()) {
     int nextValue = utf8EncodedBytesIterator.current;
     if (nextValue &gt; _UTF8_ONE_BYTE_MAX &amp;&amp;
         nextValue &lt; _UTF8_FIRST_BYTE_OF_TWO_BASE) {
       value = ((value &lt;&lt; 6) | (nextValue &amp; _UTF8_LO_SIX_BIT_MASK));
     } else {
       // if sequence-starting code unit, reposition cursor to start here
       if (nextValue &gt;= _UTF8_FIRST_BYTE_OF_TWO_BASE) {
         utf8EncodedBytesIterator.backup();
       }
       break;
     }
     j++;
   }
   bool validSequence = (j == additionalBytes &amp;&amp; (
       value &lt; UNICODE_UTF16_RESERVED_LO ||
       value &gt; UNICODE_UTF16_RESERVED_HI));
   bool nonOverlong =
       (additionalBytes == 1 &amp;&amp; value &gt; _UTF8_ONE_BYTE_MAX) ||
       (additionalBytes == 2 &amp;&amp; value &gt; _UTF8_TWO_BYTE_MAX) ||
       (additionalBytes == 3 &amp;&amp; value &gt; _UTF8_THREE_BYTE_MAX);
   bool inRange = value &lt;= UNICODE_VALID_RANGE_MAX;
   if (validSequence &amp;&amp; nonOverlong &amp;&amp; inRange) {
     _current = value;
     return true;
   } else if (replacementCodepoint != null) {
     _current = replacementCodepoint;
     return true;
   } else {
     throw new ArgumentError(
         "Invalid UTF8 at ${utf8EncodedBytesIterator.position - j}");
   }
 }
}
</pre>
</div>
<h3>Implements</h3>
<p>
<span class="type-box"><span class="icon-class"></span><a href="../dart_core/Iterator.html">Iterator&lt;int&gt;</a></span></p>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="">
<button class="show-code">Code</button>
new <strong>Utf8Decoder</strong>(<a href="http://api.dartlang.org/dart_core/List.html">List</a>&lt;<a href="http://api.dartlang.org/dart_core/int.html">int</a>&gt; utf8EncodedBytes, [<a href="http://api.dartlang.org/dart_core/int.html">int</a> offset = 0, <a href="http://api.dartlang.org/dart_core/int.html">int</a> length, <a href="http://api.dartlang.org/dart_core/int.html">int</a> replacementCodepoint = UNICODE_REPLACEMENT_CHARACTER_CODEPOINT]) <a class="anchor-link" href="#"
              title="Permalink to Utf8Decoder.Utf8Decoder">#</a></h4>
<div class="doc">
<div class="inherited">
<p>Creates a new <a class="crossref" href="../dart_core/Object.html">Object</a> instance.</p>
<p><a class="crossref" href="../dart_core/Object.html">Object</a> instances have no meaningful state, and are only useful
through their identity. An <a class="crossref" href="../dart_core/Object.html">Object</a> instance is equal to itself
only.</p>
<div class="docs-inherited-from">docs inherited from <a href="http://api.dartlang.org/dart_core/Object.html">Object</a> </div></div>
<pre class="source">
Utf8Decoder(List&lt;int&gt; utf8EncodedBytes, [int offset = 0, int length,
   this.replacementCodepoint =
   UNICODE_REPLACEMENT_CHARACTER_CODEPOINT]) :
   utf8EncodedBytesIterator =
       (new _ListRange(utf8EncodedBytes, offset, length)).iterator;
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field"><h4 id="current">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_core/int.html">int</a>         <strong>current</strong> <a class="anchor-link"
            href="#current"
            title="Permalink to Utf8Decoder.current">#</a>
        </h4>
        <div class="doc">
<div class="inherited">
<p>Returns the current element.</p>
<p>Return <code>null</code> if the iterator has not yet been moved to the first
element, or if the iterator has been moved after the last element of the
<a class="crossref" href="../dart_core/Iterable.html">Iterable</a>.</p>
<div class="docs-inherited-from">docs inherited from <a href="http://api.dartlang.org/dart_core/Iterator.html">Iterator</a>&lt;<a href="http://api.dartlang.org/dart_core/int.html">int</a>&gt; </div></div>
<pre class="source">
int get current =&gt; _current;
</pre>
</div>
</div>
<div class="field"><h4 id="replacementCodepoint">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_core/int.html">int</a>         <strong>replacementCodepoint</strong> <a class="anchor-link"
            href="#replacementCodepoint"
            title="Permalink to Utf8Decoder.replacementCodepoint">#</a>
        </h4>
        <div class="doc">
<pre class="source">
final int replacementCodepoint
</pre>
</div>
</div>
<div class="field"><h4 id="utf8EncodedBytesIterator">
<button class="show-code">Code</button>
final <a href="../utf/_ListRangeIterator.html">_ListRangeIterator</a>         <strong>utf8EncodedBytesIterator</strong> <a class="anchor-link"
            href="#utf8EncodedBytesIterator"
            title="Permalink to Utf8Decoder.utf8EncodedBytesIterator">#</a>
        </h4>
        <div class="doc">
<pre class="source">
final _ListRangeIterator utf8EncodedBytesIterator
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="decodeRest">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/List.html">List</a>&lt;<a href="http://api.dartlang.org/dart_core/int.html">int</a>&gt; <strong>decodeRest</strong>() <a class="anchor-link" href="#decodeRest"
              title="Permalink to Utf8Decoder.decodeRest">#</a></h4>
<div class="doc">
<p>Decode the remaininder of the characters in this decoder
into a [List<int>].</p>
<pre class="source">
List&lt;int&gt; decodeRest() {
 List&lt;int&gt; codepoints = new List&lt;int&gt;(utf8EncodedBytesIterator.remaining);
 int i = 0;
 while (moveNext()) {
   codepoints[i++] = current;
 }
 if (i == codepoints.length) {
   return codepoints;
 } else {
   List&lt;int&gt; truncCodepoints = new List&lt;int&gt;(i);
   truncCodepoints.setRange(0, i, codepoints);
   return truncCodepoints;
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="moveNext">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/bool.html">bool</a> <strong>moveNext</strong>() <a class="anchor-link" href="#moveNext"
              title="Permalink to Utf8Decoder.moveNext">#</a></h4>
<div class="doc">
<div class="inherited">
<p>Moves to the next element. Returns true if <a class="crossref" href="../utf/Utf8Decoder.html#current">current</a> contains the next
element. Returns false, if no element was left.</p>
<p>It is safe to invoke <a class="crossref" href="../utf/Utf8Decoder.html#moveNext">moveNext</a> even when the iterator is already
positioned after the last element. In this case <a class="crossref" href="../utf/Utf8Decoder.html#moveNext">moveNext</a> has no effect.</p>
<div class="docs-inherited-from">docs inherited from <a href="http://api.dartlang.org/dart_core/Iterator.html">Iterator</a>&lt;<a href="http://api.dartlang.org/dart_core/int.html">int</a>&gt; </div></div>
<pre class="source">
bool moveNext() {
 _current = null;

 if (!utf8EncodedBytesIterator.moveNext()) return false;

 int value = utf8EncodedBytesIterator.current;
 int additionalBytes = 0;

 if (value &lt; 0) {
   if (replacementCodepoint != null) {
     _current = replacementCodepoint;
     return true;
   } else {
     throw new ArgumentError(
         "Invalid UTF8 at ${utf8EncodedBytesIterator.position}");
   }
 } else if (value &lt;= _UTF8_ONE_BYTE_MAX) {
   _current = value;
   return true;
 } else if (value &lt; _UTF8_FIRST_BYTE_OF_TWO_BASE) {
   if (replacementCodepoint != null) {
     _current = replacementCodepoint;
     return true;
   } else {
     throw new ArgumentError(
         "Invalid UTF8 at ${utf8EncodedBytesIterator.position}");
   }
 } else if (value &lt; _UTF8_FIRST_BYTE_OF_THREE_BASE) {
   value -= _UTF8_FIRST_BYTE_OF_TWO_BASE;
   additionalBytes = 1;
 } else if (value &lt; _UTF8_FIRST_BYTE_OF_FOUR_BASE) {
   value -= _UTF8_FIRST_BYTE_OF_THREE_BASE;
   additionalBytes = 2;
 } else if (value &lt; _UTF8_FIRST_BYTE_OF_FIVE_BASE) {
   value -= _UTF8_FIRST_BYTE_OF_FOUR_BASE;
   additionalBytes = 3;
 } else if (value &lt; _UTF8_FIRST_BYTE_OF_SIX_BASE) {
   value -= _UTF8_FIRST_BYTE_OF_FIVE_BASE;
   additionalBytes = 4;
 } else if (value &lt; _UTF8_FIRST_BYTE_BOUND_EXCL) {
   value -= _UTF8_FIRST_BYTE_OF_SIX_BASE;
   additionalBytes = 5;
 } else if (replacementCodepoint != null) {
   _current = replacementCodepoint;
   return true;
 } else {
   throw new ArgumentError(
       "Invalid UTF8 at ${utf8EncodedBytesIterator.position}");
 }
 int j = 0;
 while (j &lt; additionalBytes &amp;&amp; utf8EncodedBytesIterator.moveNext()) {
   int nextValue = utf8EncodedBytesIterator.current;
   if (nextValue &gt; _UTF8_ONE_BYTE_MAX &amp;&amp;
       nextValue &lt; _UTF8_FIRST_BYTE_OF_TWO_BASE) {
     value = ((value &lt;&lt; 6) | (nextValue &amp; _UTF8_LO_SIX_BIT_MASK));
   } else {
     // if sequence-starting code unit, reposition cursor to start here
     if (nextValue &gt;= _UTF8_FIRST_BYTE_OF_TWO_BASE) {
       utf8EncodedBytesIterator.backup();
     }
     break;
   }
   j++;
 }
 bool validSequence = (j == additionalBytes &amp;&amp; (
     value &lt; UNICODE_UTF16_RESERVED_LO ||
     value &gt; UNICODE_UTF16_RESERVED_HI));
 bool nonOverlong =
     (additionalBytes == 1 &amp;&amp; value &gt; _UTF8_ONE_BYTE_MAX) ||
     (additionalBytes == 2 &amp;&amp; value &gt; _UTF8_TWO_BYTE_MAX) ||
     (additionalBytes == 3 &amp;&amp; value &gt; _UTF8_THREE_BYTE_MAX);
 bool inRange = value &lt;= UNICODE_VALID_RANGE_MAX;
 if (validSequence &amp;&amp; nonOverlong &amp;&amp; inRange) {
   _current = value;
   return true;
 } else if (replacementCodepoint != null) {
   _current = replacementCodepoint;
   return true;
 } else {
   throw new ArgumentError(
       "Invalid UTF8 at ${utf8EncodedBytesIterator.position - j}");
 }
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        

        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>SourceFile class / source_maps.span Library / Hop Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="source_maps.span" data-type="SourceFile">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Hop Documentation</a>
         &rsaquo; <a href="../source_maps.span.html">source_maps.span</a> &rsaquo; <a href="../source_maps.span/SourceFile.html">SourceFile</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>SourceFile</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<p>Stores information about a source file, to permit computation of the line
and column. Also contains a nice default error message highlighting the code
location.</p>
<pre class="source">
class SourceFile {
 /// Url where the source file is located.
 final String url;
 final List&lt;int&gt; _lineStarts;
 final List&lt;int&gt; _decodedChars;

 SourceFile(this.url, this._lineStarts, this._decodedChars);

 SourceFile.text(this.url, String text)
     : _lineStarts = &lt;int&gt;[0],
       _decodedChars = text.runes.toList() {
   for (int i = 0; i &lt; _decodedChars.length; i++) {
     var c = _decodedChars[i];
     if (c == _CR) {
       // Return not followed by newline is treated as a newline
       int j = i + 1;
       if (j &gt;= _decodedChars.length || _decodedChars[j] != _LF) {
         c = _LF;
       }
     }
     if (c == _LF) _lineStarts.add(i + 1);
   }
 }

 /// Returns a span in this [SourceFile] with the given offsets.
 Span span(int start, [int end, bool isIdentifier = false]) =&gt;
     new FileSpan(this, start, end, isIdentifier);

 /// Returns a location in this [SourceFile] with the given offset.
 Location location(int offset) =&gt; new FileLocation(this, offset);

 /// Gets the 0-based line corresponding to an offset.
 int getLine(int offset) =&gt; binarySearch(_lineStarts, (o) =&gt; o &gt; offset) - 1;

 /// Gets the 0-based column corresponding to an offset.
 int getColumn(int line, int offset) {
   if (line &lt; 0 || line &gt;= _lineStarts.length) return 0;
   return offset - _lineStarts[line];
 }

 /// Get the offset for a given line and column
 int getOffset(int line, int column) {
   if (line &lt; 0) return getOffset(0, 0);
   if (line &lt; _lineStarts.length) {
     return _lineStarts[line] + column;
   } else {
     return _decodedChars.length;
   }
 }

 /// Gets the text at the given offsets.
 String getText(int start, [int end]) =&gt;
     new String.fromCharCodes(_decodedChars.sublist(max(start, 0), end));

 /// Create a pretty string representation from a span.
 String getLocationMessage(String message, int start, int end,
     {bool useColors: false, String color}) {
   // TODO(jmesserly): it would be more useful to pass in an object that
   // controls how the errors are printed. This method is a bit too smart.
   var line = getLine(start);
   var column = getColumn(line, start);

   var src = url == null ? '' : url;
   var msg = '$src:${line + 1}:${column + 1}: $message';

   if (_decodedChars == null) {
     // We don't have any text to include, so exit.
     return msg;
   }

   var buf = new StringBuffer(msg);
   buf.write('\n');

   // +1 for 0-indexing, +1 again to avoid the last line
   var textLine = getText(getOffset(line, 0), getOffset(line + 1, 0));

   column = min(column, textLine.length - 1);
   int toColumn = min(column + end - start, textLine.length);
   if (useColors) {
     if (color == null) {
       color = _RED_COLOR;
     }
     buf.write(textLine.substring(0, column));
     buf.write(color);
     buf.write(textLine.substring(column, toColumn));
     buf.write(_NO_COLOR);
     buf.write(textLine.substring(toColumn));
   } else {
     buf.write(textLine);
     if (textLine != '' &amp;&amp; !textLine.endsWith('\n')) buf.write('\n');
   }

   int i = 0;
   for (; i &lt; column; i++) {
     buf.write(' ');
   }

   if (useColors) buf.write(color);
   for (; i &lt; toColumn; i++) {
     buf.write('^');
   }
   if (useColors) buf.write(_NO_COLOR);
   return buf.toString();
 }
}
</pre>
</div>
<h3>Subclasses</h3>
<p>
<span class="type-box"><span class="icon-class"></span><a href="../source_maps.span/SourceFileSegment.html">SourceFileSegment</a></span></p>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="">
<button class="show-code">Code</button>
new <strong>SourceFile</strong>(<a href="http://api.dartlang.org/dart_core/String.html" ref="external">String</a> url, <a href="http://api.dartlang.org/dart_core/List.html" ref="external">List</a>&lt;<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a>&gt; _lineStarts, <a href="http://api.dartlang.org/dart_core/List.html" ref="external">List</a>&lt;<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a>&gt; _decodedChars) <a class="anchor-link" href="#"
              title="Permalink to SourceFile.SourceFile">#</a></h4>
<div class="doc">
<div class="inherited">
<p>Creates a new <a class="crossref" href="http://api.dartlang.org/dart_core/Object.html">Object</a> instance.</p>
<p><a class="crossref" href="http://api.dartlang.org/dart_core/Object.html">Object</a> instances have no meaningful state, and are only useful
through their identity. An <a class="crossref" href="http://api.dartlang.org/dart_core/Object.html">Object</a> instance is equal to itself
only.</p>
<div class="docs-inherited-from">docs inherited from <a href="http://api.dartlang.org/dart_core/Object.html" ref="external">Object</a> </div></div>
<pre class="source">
SourceFile(this.url, this._lineStarts, this._decodedChars);
</pre>
</div>
</div>
<div class="method"><h4 id="text">
<button class="show-code">Code</button>
new <strong>SourceFile.text</strong>(<a href="http://api.dartlang.org/dart_core/String.html" ref="external">String</a> url, <a href="http://api.dartlang.org/dart_core/String.html" ref="external">String</a> text) <a class="anchor-link" href="#text"
              title="Permalink to SourceFile.SourceFile.text">#</a></h4>
<div class="doc">
<pre class="source">
SourceFile.text(this.url, String text)
   : _lineStarts = &lt;int&gt;[0],
     _decodedChars = text.runes.toList() {
 for (int i = 0; i &lt; _decodedChars.length; i++) {
   var c = _decodedChars[i];
   if (c == _CR) {
     // Return not followed by newline is treated as a newline
     int j = i + 1;
     if (j &gt;= _decodedChars.length || _decodedChars[j] != _LF) {
       c = _LF;
     }
   }
   if (c == _LF) _lineStarts.add(i + 1);
 }
}
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field"><h4 id="url">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_core/String.html" ref="external">String</a>         <strong>url</strong> <a class="anchor-link"
            href="#url"
            title="Permalink to SourceFile.url">#</a>
        </h4>
        <div class="doc">
<p>Url where the source file is located.</p>
<pre class="source">
final String url
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="getColumn">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> <strong>getColumn</strong>(<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> line, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> offset) <a class="anchor-link" href="#getColumn"
              title="Permalink to SourceFile.getColumn">#</a></h4>
<div class="doc">
<p>Gets the 0-based column corresponding to an offset.</p>
<pre class="source">
int getColumn(int line, int offset) {
 if (line &lt; 0 || line &gt;= _lineStarts.length) return 0;
 return offset - _lineStarts[line];
}
</pre>
</div>
</div>
<div class="method"><h4 id="getLine">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> <strong>getLine</strong>(<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> offset) <a class="anchor-link" href="#getLine"
              title="Permalink to SourceFile.getLine">#</a></h4>
<div class="doc">
<p>Gets the 0-based line corresponding to an offset.</p>
<pre class="source">
int getLine(int offset) =&gt; binarySearch(_lineStarts, (o) =&gt; o &gt; offset) - 1;
</pre>
</div>
</div>
<div class="method"><h4 id="getLocationMessage">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/String.html" ref="external">String</a> <strong>getLocationMessage</strong>(<a href="http://api.dartlang.org/dart_core/String.html" ref="external">String</a> message, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> start, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> end, {<a href="http://api.dartlang.org/dart_core/bool.html" ref="external">bool</a> useColors: false, <a href="http://api.dartlang.org/dart_core/String.html" ref="external">String</a> color}) <a class="anchor-link" href="#getLocationMessage"
              title="Permalink to SourceFile.getLocationMessage">#</a></h4>
<div class="doc">
<p>Create a pretty string representation from a span.</p>
<pre class="source">
String getLocationMessage(String message, int start, int end,
   {bool useColors: false, String color}) {
 // TODO(jmesserly): it would be more useful to pass in an object that
 // controls how the errors are printed. This method is a bit too smart.
 var line = getLine(start);
 var column = getColumn(line, start);

 var src = url == null ? '' : url;
 var msg = '$src:${line + 1}:${column + 1}: $message';

 if (_decodedChars == null) {
   // We don't have any text to include, so exit.
   return msg;
 }

 var buf = new StringBuffer(msg);
 buf.write('\n');

 // +1 for 0-indexing, +1 again to avoid the last line
 var textLine = getText(getOffset(line, 0), getOffset(line + 1, 0));

 column = min(column, textLine.length - 1);
 int toColumn = min(column + end - start, textLine.length);
 if (useColors) {
   if (color == null) {
     color = _RED_COLOR;
   }
   buf.write(textLine.substring(0, column));
   buf.write(color);
   buf.write(textLine.substring(column, toColumn));
   buf.write(_NO_COLOR);
   buf.write(textLine.substring(toColumn));
 } else {
   buf.write(textLine);
   if (textLine != '' &amp;&amp; !textLine.endsWith('\n')) buf.write('\n');
 }

 int i = 0;
 for (; i &lt; column; i++) {
   buf.write(' ');
 }

 if (useColors) buf.write(color);
 for (; i &lt; toColumn; i++) {
   buf.write('^');
 }
 if (useColors) buf.write(_NO_COLOR);
 return buf.toString();
}
</pre>
</div>
</div>
<div class="method"><h4 id="getOffset">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> <strong>getOffset</strong>(<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> line, <a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> column) <a class="anchor-link" href="#getOffset"
              title="Permalink to SourceFile.getOffset">#</a></h4>
<div class="doc">
<p>Get the offset for a given line and column</p>
<pre class="source">
int getOffset(int line, int column) {
 if (line &lt; 0) return getOffset(0, 0);
 if (line &lt; _lineStarts.length) {
   return _lineStarts[line] + column;
 } else {
   return _decodedChars.length;
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="getText">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/String.html" ref="external">String</a> <strong>getText</strong>(<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> start, [<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> end]) <a class="anchor-link" href="#getText"
              title="Permalink to SourceFile.getText">#</a></h4>
<div class="doc">
<p>Gets the text at the given offsets.</p>
<pre class="source">
String getText(int start, [int end]) =&gt;
   new String.fromCharCodes(_decodedChars.sublist(max(start, 0), end));
</pre>
</div>
</div>
<div class="method"><h4 id="location">
<button class="show-code">Code</button>
<a href="../source_maps.span/Location.html">Location</a> <strong>location</strong>(<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> offset) <a class="anchor-link" href="#location"
              title="Permalink to SourceFile.location">#</a></h4>
<div class="doc">
<p>Returns a location in this <a class="crossref" href="../source_maps.span/SourceFile.html">SourceFile</a> with the given offset.</p>
<pre class="source">
Location location(int offset) =&gt; new FileLocation(this, offset);
</pre>
</div>
</div>
<div class="method"><h4 id="span">
<button class="show-code">Code</button>
<a href="../source_maps.span/Span.html">Span</a> <strong>span</strong>(<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> start, [<a href="http://api.dartlang.org/dart_core/int.html" ref="external">int</a> end, <a href="http://api.dartlang.org/dart_core/bool.html" ref="external">bool</a> isIdentifier = false]) <a class="anchor-link" href="#span"
              title="Permalink to SourceFile.span">#</a></h4>
<div class="doc">
<p>Returns a span in this <a class="crossref" href="../source_maps.span/SourceFile.html">SourceFile</a> with the given offsets.</p>
<pre class="source">
Span span(int start, [int end, bool isIdentifier = false]) =&gt;
   new FileSpan(this, start, end, isIdentifier);
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        
